(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{30048:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var l=r(95155),s=r(97049);function a(e){if(!e)return"";let t=new Date(1e3*e.created_at),r=t.getFullYear(),l=("0"+(t.getMonth()+1)).slice(-2),s=("0"+t.getDate()).slice(-2),a=t.getHours(),n=a,i=("0"+t.getMinutes()).slice(-2),o="AM";return a>12?(n=a-12,o="PM"):12===a?(n=12,o="PM"):0==a&&(n=12),s+"-"+l+"-"+r+", "+n+":"+i+" "+o}let n=e=>{let t=e.match(/https:\/\/.*?\.(jpg|png|webp)/gi),r=e.match(/https:\/\/.*?\.(mp4|avi|mov)/gi);return{images:t?[...t]:[],videos:r?[...r]:[]}};function i(e){let t=n(e),r=e;return{mediaUrls:t,textContent:(r=(r=(r=(r=(r=(r=(r=(r=r.replace(/https:\/\/.*\.(jpg|png|mp4|avi|mov|webp)/gi,"")).replace(/(nostr:note[a-zA-Z0-9]{59,65})/g,e=>{let t=e.substring(0,10),r=e.substring(e.length-6);return"".concat(t,"...").concat(r)})).replace(/(nostr:npub[a-zA-Z0-9]{59,65})/g,e=>{let t=e.substring(0,10),r=e.substring(e.length-6);return"".concat(t,"...").concat(r)})).replace(/(https?:\/\/[^\s]{30,})/g,e=>{try{let t=new URL(e).hostname;return"".concat(t,"/...")}catch(t){return"".concat(e.substring(0,25),"...")}})).replace(/\n{3,}/g,"\n\n")).split("\n").map(e=>""===e.trim()?"":e).join("\n")).replace(/\n\n\n+/g,"\n\n")).replace(/[ ]{2,}/g," ")).trim()}}var o=r(12115);let c=function(e){let t=/(#\w+)/g,r=e.split(/(\s+)/).flatMap(e=>e.split(t));return(0,l.jsx)(o.Fragment,{children:r.map((e,t)=>e.startsWith("#")?(0,l.jsx)("span",{className:"font-bold text-blue-500",children:e},t):(0,l.jsx)("span",{children:e},t))})};var d=r(98590);let u=()=>{let e=(0,o.useContext)(d.b);if(void 0===e)throw Error("useImageOverlay must be used within an ImageOverlayProvider");return e};var m=r(71007),g=r(66766),p=r(88275);let x=(0,o.createContext)({profiles:{},getProfile:()=>null,loadProfile:()=>{},isLoadingProfile:()=>!1});function h(e){let{children:t}=e,[r,a]=(0,o.useState)({}),[n,i]=(0,o.useState)(new Set),[c,d]=(0,o.useState)(new Set),{events:u}=(0,s.zE)({filter:{authors:Array.from(c),kinds:[0],limit:50},enabled:c.size>0});return(0,o.useEffect)(()=>{if(u.length>0){let e={...r};u.forEach(t=>{try{let r=JSON.parse(t.content);e[t.pubkey]=r,i(e=>{let r=new Set(e);return r.delete(t.pubkey),r})}catch(e){console.error("Error parsing profile:",e)}}),a(e)}},[u,r]),(0,o.useEffect)(()=>{if(u.length>0){let e={...r};u.forEach(t=>{try{let r=JSON.parse(t.content);e[t.pubkey]=r,i(e=>{let r=new Set(e);return r.delete(t.pubkey),r})}catch(e){console.error("Error parsing profile:",e,"for pubkey:",t.pubkey)}}),console.log("Updated profiles:",e),a(e)}},[u]),(0,l.jsx)(x.Provider,{value:{profiles:r,getProfile:e=>r[e]||null,loadProfile:e=>{if(e){if(r[e]||n.has(e)||c.has(e))return void console.log("Profile already loaded or loading:",e);d(t=>{let r=new Set(t);return r.add(e),r}),i(t=>{let r=new Set(t);return r.add(e),r})}},isLoadingProfile:e=>n.has(e)},children:t})}let f=()=>(0,o.useContext)(x),b=e=>{let{noteId:t}=e,[r,n]=(0,o.useState)(!1),d=function(e){try{if(e.startsWith("note1")){let{data:t}=p.Qe.decode(e);if("string"==typeof t&&/^[a-f0-9]{64}$/.test(t))return t;return console.error("Decoded note ID is not in the expected hex format:",t),""}if(/^[a-f0-9]{64}$/.test(e))return e;return console.error("Note ID is not in a recognized format:",e),""}catch(e){return console.error("Error decoding note ID:",e),""}}(t),{loadProfile:u,getProfile:x}=f(),{events:h,isLoading:b}=(0,s.zE)({filter:{ids:d?[d]:[],kinds:[1],limit:1},enabled:!!d}),v=h.length>0?h[0]:null;(0,o.useEffect)(()=>{(null==v?void 0:v.pubkey)&&(console.log("Loading profile for quoted post:",v.pubkey),u(v.pubkey))},[null==v?void 0:v.pubkey,u]);let y=(null==v?void 0:v.pubkey)?x(v.pubkey):null;if(b)return(0,l.jsxs)("div",{className:"animate-pulse rounded-md border bg-gray-50 p-3 dark:bg-gray-800",children:[(0,l.jsx)("div",{className:"mb-2 h-4 w-3/4 rounded bg-gray-200 dark:bg-gray-700"}),(0,l.jsx)("div",{className:"h-4 w-1/2 rounded bg-gray-200 dark:bg-gray-700"})]});if(!d)return(0,l.jsx)("div",{className:"rounded-md border bg-gray-50 p-4 dark:bg-gray-800",children:(0,l.jsx)("div",{className:"text-sm text-red-500",children:"Invalid note ID format"})});if(!v)return null;let{mediaUrls:j,textContent:w}=i(v.content),N=w.trim().length>0;return(0,l.jsxs)("div",{className:"rounded-lg border border-gray-200 p-4 transition hover:border-gray-300",children:[(0,l.jsxs)("div",{className:"mb-2 flex items-center",children:[(0,l.jsxs)("div",{className:"group flex items-center gap-2",children:[(null==y?void 0:y.picture)&&!r?(0,l.jsx)(g.default,{src:y.picture,alt:"".concat(y.display_name,"'s profile"),width:30,height:30,onError:()=>n(!0),className:"h-[30px] w-[30px] rounded-full object-cover"}):(0,l.jsx)("div",{className:"flex h-[30px] w-[30px] items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700",children:(0,l.jsx)(m.A,{size:16,className:"text-gray-400"})}),(0,l.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,l.jsx)("div",{className:"text-sm font-semibold text-black group-hover:text-blue-500 dark:text-white",children:(null==y?void 0:y.display_name)||(null==y?void 0:y.name)||"".concat(v.pubkey.substring(0,8),"...")}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["@",null==y?void 0:y.name]})]})]}),(0,l.jsx)("div",{className:"ml-auto text-right text-xs text-gray-500",children:a(v)})]}),N&&(0,l.jsx)("div",{className:"hyphens-auto whitespace-pre-wrap text-sm leading-normal",children:c(w)}),j.images&&j.images.length>0&&(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)(g.default,{src:j.images[0],alt:"Embedded media",width:300,height:200,className:"max-h-[150px] w-auto rounded-md object-cover"})})]})};function v(e){let{profilePicture:t,displayName:r,username:s,content:n,timestamp:d,pubkey:p}=e,{setOverlayImage:x}=u(),[h,v]=(0,o.useState)(!1),[y,j]=(0,o.useState)([]),{mediaUrls:w,textContent:N}=i(n),{loadProfile:k,getProfile:E,isLoadingProfile:S}=f();(0,o.useEffect)(()=>{p&&k(p)},[p,k]);let P=p?E(p):null,z=!!p&&S(p),I=t||(null==P?void 0:P.picture),C=r||(null==P?void 0:P.display_name),_=s||(null==P?void 0:P.name);(0,o.useEffect)(()=>{let e=function(e){let t,r=/(note1[a-zA-Z0-9]{20,})/g,l=[];for(;null!==(t=r.exec(e));)t[1]&&l.push(t[1]);return l}(n);j(e),console.log("Extracted note IDs:",e)},[n]);let A=N.trim().length>0;return(0,l.jsxs)("div",{className:"flex flex-col gap-2.5 border-gray-200 p-4 transition duration-200 hover:border-gray-300 dark:border-gray-900 dark:bg-black dark:hover:border-gray-800 sm:w-[600px] sm:rounded-2xl sm:border",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"group flex gap-[10px]",children:[I&&!h?(0,l.jsx)(g.default,{src:I,alt:"".concat(C,"'s profile picture"),width:40,height:40,onError:()=>v(!0),className:"h-[40px] w-[40px] rounded-full object-cover"}):(0,l.jsx)("div",{className:"flex h-[40px] w-[40px] items-center justify-center rounded-full bg-gray-200 dark:bg-gray-800",children:(0,l.jsx)(m.A,{size:24,className:"text-gray-400"})}),(0,l.jsxs)("div",{className:"flex flex-col gap-px",children:[(0,l.jsx)("p",{className:"text-sm font-bold group-hover:text-blue-500",children:z?(0,l.jsx)("span",{className:"animate-pulse",children:"Loading..."}):C||"".concat(null==p?void 0:p.substring(0,8),"...")}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:["@",_||(p?p.substring(0,8):"anonymous")]})]})]}),(0,l.jsx)("div",{className:"flex items-center gap-[15px] max-sm:gap-2.5",children:(0,l.jsx)("p",{className:"text-right text-sm text-gray-500",children:a(d)})})]}),A&&(0,l.jsx)("div",{className:"hyphens-auto whitespace-pre-wrap leading-normal",children:c(N)}),y.length>0&&(0,l.jsx)("div",{className:"mt-4",children:y.map(e=>(0,l.jsx)(b,{noteId:e},e))}),(e=>{let{images:t,videos:r}=e;return(null==t?void 0:t.length)||(null==r?void 0:r.length)?(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[t.map((e,t)=>(0,l.jsx)("div",{className:"relative",children:(0,l.jsx)(g.default,{src:e,alt:"Media content ".concat(t+1),onClick:()=>x(e),width:1e3,height:1e3,className:"w-full scale-100 cursor-pointer rounded-xl transition hover:opacity-90 active:scale-[0.98]",onError:()=>v(!0)})},"img-".concat(t))),r.map((e,t)=>(0,l.jsx)("video",{src:e,className:"w-full rounded-[10px]",controls:!0,autoPlay:!0,muted:!0},"video-".concat(t)))]}):null})(w)]})}function y(e){let{filterType:t,maxElements:r}=e,{events:a}=(0,s.zE)({filter:{authors:["9c9f81ed795f0f5efa558932824687d84fc7e6a4cfa6db5d6d3b50fcb7ffaec2"],since:0,kinds:[1],limit:20}}),{getProfile:i,loadProfile:c}=f();return(0,o.useEffect)(()=>{a.length>0&&[...new Set(a.map(e=>e.pubkey))].forEach(e=>{c(e)})},[a,c]),(0,l.jsx)("div",{className:"flex flex-col items-center gap-[20px] overflow-x-hidden sm:gap-[10px]",children:a.filter(e=>{let{images:r,videos:l}=n(e.content);return"image"===t&&!!(r.length>0)||"video"===t&&!!(l.length>0)||"text"===t&&0===r.length&&0===l.length||"all"===t}).slice(0,r).map(e=>{let t=i(e.pubkey);return console.log("User data:",t),(0,l.jsxs)("div",{children:[(0,l.jsx)(v,{profilePicture:null==t?void 0:t.picture,displayName:null==t?void 0:t.display_name,username:null==t?void 0:t.name,timestamp:e,content:e.content,pubkey:e.pubkey}),(0,l.jsx)("div",{className:"h-px w-full bg-gray-200 dark:bg-gray-800 sm:h-0"})]},e.id)})})}var j=r(13052),w=r(6874),N=r.n(w);function k(){return(0,l.jsx)("div",{children:(0,l.jsxs)(d.p,{children:[(0,l.jsx)("nav",{className:"fixed left-0 right-0 top-0 z-50 flex w-full items-center justify-between bg-white/80 backdrop-blur-lg dark:bg-black/80",children:(0,l.jsx)("div",{className:"mx-3 my-3 w-full items-center justify-between sm:mx-20",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)(N(),{href:"/",className:"flex flex-col items-start text-start font-bold leading-snug opacity-50 transition hover:opacity-100",children:["Frederik",(0,l.jsx)("br",{}),"Handberg"]}),(0,l.jsx)(j.A,{className:"opacity-50"}),(0,l.jsx)(N(),{href:"/blog",className:"font-semibold opacity-50 hover:opacity-100",children:"Blog"})]})})}),(0,l.jsx)("div",{className:"mt-24",children:(0,l.jsx)(s.Y$,{relayUrls:["wss://relay.primal.net","wss://relay.damus.io"],debug:!0,children:(0,l.jsx)(h,{children:(0,l.jsx)(y,{filterType:"all"})})})})]})})}},35217:(e,t,r)=>{Promise.resolve().then(r.bind(r,30048))},98590:(e,t,r)=>{"use strict";r.d(t,{b:()=>a,p:()=>n});var l=r(95155),s=r(12115);let a=(0,s.createContext)({overlayImage:null,setOverlayImage:()=>{}}),n=e=>{let{children:t}=e,[r,n]=(0,s.useState)(null),i=e=>{n(e),e?document.body.style.overflow="hidden":document.body.style.overflow="auto"};return(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r&&i(null)};return r&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[r]),(0,l.jsxs)(a.Provider,{value:{overlayImage:r,setOverlayImage:i},children:[t,r&&(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 backdrop-blur-sm",onClick:e=>{e.target===e.currentTarget&&i(null)},children:(0,l.jsxs)("div",{className:"relative max-h-full max-w-full overflow-hidden",children:[(0,l.jsx)("button",{className:"absolute right-0 top-0 m-4 rounded-full bg-black/50 px-2 py-1 font-semibold text-white hover:bg-black/95",onClick:()=>i(null),children:"Close"}),(0,l.jsx)("img",{src:r,alt:"Fullscreen",className:"max-h-[90vh] max-w-[90vw] rounded-lg"})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[672,396,441,684,358],()=>t(35217)),_N_E=e.O()}]);